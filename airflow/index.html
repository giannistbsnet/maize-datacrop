<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> DataCROP </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/home/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Maize Setup category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Setup/" class="nav-list-link">Maize Setup</a><ul class="nav-list"><li class="nav-list-item"><a href="/keycloak/" class="nav-list-link">1. Keycloak Setup</a></li><li class="nav-list-item"><a href="/airflow/" class="nav-list-link">2. Airflow Setup</a></li><li class="nav-list-item"><a href="/worker/" class="nav-list-link">3. Worker Setup</a></li><li class="nav-list-item"><a href="/model-repo/" class="nav-list-link">4. Model Repository Setup</a></li><li class="nav-list-item"><a href="/editor/" class="nav-list-link">5. Workflow Editor Setup</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in User Guide category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/user-guide/" class="nav-list-link">User Guide</a><ul class="nav-list"><li class="nav-list-item"><a href="/overview/" class="nav-list-link">1. Getting Started</a></li><li class="nav-list-item"><a href="/creating-data-models/" class="nav-list-link">2. Creating Data Models</a></li><li class="nav-list-item"><a href="/creating-workflows/" class="nav-list-link">3. Creating Workflows</a></li><li class="nav-list-item"><a href="/airflow-note/" class="nav-list-link">4. Airflow</a></li></ul></li><li class="nav-list-item"><a href="/dev-guide/" class="nav-list-link">Developer Guide</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DataCROP" aria-label="Search DataCROP" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/Setup/">Maize Setup</a></li> <li class="breadcrumb-nav-list-item"><span>2. Airflow Setup</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="datacrop-maize-airflow-processing-engine-deployment"> <a href="#datacrop-maize-airflow-processing-engine-deployment" class="anchor-heading" aria-labelledby="datacrop-maize-airflow-processing-engine-deployment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DataCROP Maize Airflow Processing Engine Deployment </h1> <p>This is a demo deployment instance for the <strong>Maize DataCROP version</strong>. It deploys the Airflow web server responsible for managing tasks within the <strong>DataCROP Workflow Management Engine</strong> infrastructure. The deployment consists of six containers.</p> <h2 id="overview"> <a href="#overview" class="anchor-heading" aria-labelledby="overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overview </h2> <p>The DataCROP Maize Airflow Processing Engine is a critical component of the DataCROP Workflow Management Engine. This engine is responsible for orchestrating and managing the execution of various tasks (DAGs) within the DataCROP infrastructure, providing an interface to monitor and manage workflows through the Airflow webserver.</p> <h2 id="requirements"> <a href="#requirements" class="anchor-heading" aria-labelledby="requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Requirements </h2> <ul> <li><a href="https://www.docker.com/">Docker-CE</a></li> </ul> <h2 id="prerequisites"> <a href="#prerequisites" class="anchor-heading" aria-labelledby="prerequisites"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites </h2> <p>Before proceeding with the deployment, make sure to complete the following steps:</p> <ol> <li><strong>Update Configuration Files</strong>: <ul> <li><strong><code class="language-plaintext highlighter-rouge">.env</code> File</strong>: <ul> <li>Navigate to the <a href=".env">.env</a> file and update the following parameters: <ul> <li><code class="language-plaintext highlighter-rouge">HOST_IP</code>: Set this to the IP address of the host machine where the Airflow infrastructure is deployed.</li> <li><code class="language-plaintext highlighter-rouge">CELERY_WEB_UNAME</code>: Set this to your desired username for accessing the Celery Flower dashboard.</li> <li><code class="language-plaintext highlighter-rouge">CELERY_WEB_PSSWD</code>: Set this to your desired password for the Celery Flower dashboard.</li> </ul> </li> </ul> </li> <li><strong>Docker Compose File</strong>: <ul> <li>Navigate to the <a href="docker-compose.yaml">docker-compose.yml</a> file and update the following: <ul> <li>In the <code class="language-plaintext highlighter-rouge">extra_hosts</code> section, change the IP address of <code class="language-plaintext highlighter-rouge">remote_worker01</code> to the IP address of your remote worker machine.</li> <li>If your worker has a different name, replace <code class="language-plaintext highlighter-rouge">remote_worker01</code> with the correct name of your worker.</li> </ul> </li> </ul> </li> </ul> </li> <li><strong>SSH Configuration</strong>: <ul> <li>Ensure that SSH keys are generated on all machines that are part of this infrastructure.</li> <li>Add the SSH keys from each machine to the <code class="language-plaintext highlighter-rouge">authorized_keys</code> file on all other machines in the infrastructure to allow passwordless SSH access.</li> </ul> </li> </ol> <p>Once these steps are completed, you can proceed with the deployment process.</p> <h3 id="start-the-application"> <a href="#start-the-application" class="anchor-heading" aria-labelledby="start-the-application"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Start The Application. </h3> <ol> <li>Navigate to the source directory containing the <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file.</li> <li> <p>Run the following command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> docker compose up <span class="nt">-d</span>
</code></pre></div> </div> </li> </ol> <h3 id="verify-that-everything-is-up-and-running"> <a href="#verify-that-everything-is-up-and-running" class="anchor-heading" aria-labelledby="verify-that-everything-is-up-and-running"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Verify that everything is up and running </h3> <p>Wait for the services to start, then run the following commands:</p> <ul> <li> <p>Check if the container is running (change <code class="language-plaintext highlighter-rouge">worker_name</code> with the actual name that you specified in the .env file):</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  docker ps <span class="nt">--filter</span> <span class="nv">name</span><span class="o">=</span>airflow <span class="nt">--format</span> <span class="s2">"table {{.Image}}</span><span class="se">\t</span><span class="s2">{{.Names}}"</span>
</code></pre></div> </div> <p>You should see the following output:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  IMAGE                            NAMES
  airflow-airflow-triggerer        airflow-airflow-triggerer-1
  airflow-airflow-webserver        airflow-airflow-webserver-1
  airflow-flower                   airflow-flower-1
  airflow-airflow-scheduler        airflow-airflow-scheduler-1
  postgres:13                      airflow-postgres-1
  redis:7.2                        airflow-redis-1
</code></pre></div> </div> </li> </ul> <h3 id="make-sure-everything-works"> <a href="#make-sure-everything-works" class="anchor-heading" aria-labelledby="make-sure-everything-works"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Make Sure Everything Works </h3> <ol> <li><strong>Access the Flower Web App:</strong> <ul> <li>Open a browser and navigate to <code class="language-plaintext highlighter-rouge">http://{Your IP}:5555/workers</code>.</li> <li>Log in using the <code class="language-plaintext highlighter-rouge">celery</code> credentials you provided in the <code class="language-plaintext highlighter-rouge">.env</code> file.</li> <li>After successful authentication, you should be redirected to the workers page, confirming that Celery was set up correctly.</li> </ul> </li> <li><strong>Access the Airflow Web App:</strong> <ul> <li>Open a browser and go to <code class="language-plaintext highlighter-rouge">http://{Your IP}:8080/home</code>.</li> <li>Log in using the credentials provided by your organization for Airflow.</li> <li>You should see all the available DAGs listed, confirming that your DAGs folder is properly configured.</li> </ul> </li> </ol> <h4 id="stop-everything"> <a href="#stop-everything" class="anchor-heading" aria-labelledby="stop-everything"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Stop everything. </h4> <p>Navigate to the source directory and run the following command.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose down
</code></pre></div></div> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
